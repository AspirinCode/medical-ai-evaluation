<!doctype html>
<html lang="en">
<head>
  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link href="https://unpkg.com/jquery-resizable-columns@0.2.3/dist/jquery.resizableColumns.css" rel="stylesheet">

  <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.18.0/dist/bootstrap-table.min.css">
  <link rel="stylesheet" href="utils.css">

  <script src="jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/bootstrap-table@1.18.0/dist/bootstrap-table.min.js"></script>
  <script src="https://unpkg.com/bootstrap-table@1.18.0/dist/extensions/resizable/bootstrap-table-resizable.min.js"></script>
  <script src="Chart.min.js"></script>
  <script src="utils.js"></script>
  <style>
    canvas {
      -moz-user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
  }
</style>

<title>Medical AI Evaluation Database</title>

<style type="text/css">
    html {
      font-size: 0.75rem;
  }

</style>
</head>
<body>

  <nav class="navbar navbar-expand-md navbar-light mb-0 sticky-top" style="background-color: #efefef;">
    <a class="navbar-brand" href="#">Medical AI Evaluation</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarCollapse">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link" href="#database">Database</a>
      </li>
      <li class="nav-item">
          <a class="nav-link" href="#viz">Visualizations</a>
      </li>
  </ul>

</div>
</nav>

<main>
    <div class="container-fluid bg-light mt-0" style="
    background-image: url('bg.jpg');
    background-size: cover;
    ">
    <div class="row py-lg-5">
      <div class="col-lg-6 col-md-8 mx-auto">
        <h1 class="fw-light">Medical AI Evaluation</h1>
        <p class="lead text-muted">We aggregate all 130 AI/ML FDA-approved medical devices and report information on risk and bias.</p>
        <p>
          <a href="#" class="btn btn-primary my-2">View the Code</a>
          <a href="#" class="btn btn-secondary my-2">Read the Paper</a>
      </p>
  </div>
</div>
</div>

<div id="database" class="container-fluid mx-lg-auto px-md-5 py-md-5 bg-light">

    <h2>Device Database</h2>
    <table id="table" border="1" class="dataframe table-bordered table-striped table-hover"
    data-toggle="table"
    data-url="table.json"
    data-height="600"
    data-pagination="true"
    data-search="true"
    data-search-highlight="true"
    data-show-columns="true"
    data-show-columns-toggle-all="true"
    data-show-columns-search="true"
    data-detail-view="true"
    data-detail-formatter="detailFormatter">

    <thead>
      <tr style="text-align: center;">
        <th data-field='approval_number' data-sortable='true' data-visible='true' data-switchable='true'>approval_number</th>
        <th data-field='device_name' data-sortable='true' data-visible='true' data-switchable='true'>device_name</th>
        <th data-field='classification_product_code' data-sortable='true' data-visible='false' data-switchable='true'>classification_product_code</th>
        <th data-field='date_received' data-sortable='true' data-sorter="datesSorter" data-visible='false' data-switchable='true'>date_received</th>
        <th data-field='decision_date' data-sortable='true' data-sorter="datesSorter" data-visible='true' data-switchable='true'>decision_date</th>
        <th data-field='indications_for_use' data-sortable='true' data-visible='false' data-switchable='true'>indications_for_use</th>
        <th data-field='body_area' data-sortable='true' data-visible='true' data-switchable='true'>body_area</th>
        <th data-field='modality' data-sortable='true' data-visible='true' data-switchable='true'>modality</th>
        <th data-field='predicate_numbers' data-sortable='true' data-visible='false' data-switchable='true'>predicate_numbers</th>
        <th data-field='sample_size' data-sortable='true' data-sorter="numSorter" data-visible='true' data-switchable='true'>sample_size</th>
        <th data-field='num_sites' data-sortable='true' data-sorter="numSorter" data-visible='true' data-switchable='true'>num_sites</th>
        <th data-field='inc_exc_criteria' data-sortable='true' data-visible='true' data-switchable='true'>inc_exc_criteria</th>
        <th data-field='has_demographics' data-sortable='true' data-visible='true' data-switchable='true'>has_demographics</th>
        <th data-field='is_prospective' data-sortable='true' data-visible='true' data-switchable='true'>is_prospective</th>
        <th data-field='subtype_analysis' data-sortable='true' data-visible='true' data-switchable='true'>subtype_analysis</th>
        <th data-field='significance' data-sortable='true' data-visible='false' data-switchable='true'>significance</th>
        <th data-field='severity' data-sortable='true' data-visible='false' data-switchable='true'>severity</th>
        <th data-field='risk_level' data-sortable='true' data-visible='true' data-switchable='true'>risk_level</th>
        <th data-field='keywords' data-sortable='true' data-visible='true' data-switchable='true'>keywords</th>
        <th data-field='summary_link' data-sortable='true' data-visible='false' data-switchable='true'>summary_link</th>
    </tr>
</thead>

</table>

</div>

<hr class="featurette-divider">
<div id="viz" class="container-fluid mx-lg-auto px-md-5">

  <h2>Visualizations</h2>

  <div id="container" class="col-lg-6 col-md-8 mx-auto my-5", style="width: 75%;" >
    <canvas id="bar"></canvas>
</div>

<div id="container" class="col-lg-6 col-md-8 mx-auto my-5", style="width: 75%;" >
    <canvas id="pie"></canvas>
</div>

<div class="container-fluid col-lg-6 col-md-8 mx-lg-auto px-md-5 my-5" style="width: 410px;">
  <button id="multisite" class="btn btn-primary">Show Multisite</button>
    <button id="prospective" class="btn btn-primary">Show Prospective</button>
    <button id="highrisk" class="btn btn-primary">Show High Risk</button>
<div id="figure" >

    <script>
        var head = [], heart = [], breast = [], chest = [], other = []

       $.getJSON( "table.json", function( data ) {
          $.each( data, function( key, val ) {
            var classes = 'hovicon mini effect-9 sub-a'
            if (val['risk_level'] == '1' || val['risk_level'] == '2') {
              classes += ' highrisk'
          }
          if (val['num_sites'] == 'NA' || val['num_sites'] == '1') {
              classes += ' multisite'
          }
          if (val['is_prospective'] != '1') {
              classes += ' prospective'
          }
          var body_area = val['body_area'].toLowerCase()
          classes += ' ' + body_area
          if (body_area == 'chest') {
            chest.push([val['device_name'], classes])
          } else if (body_area == 'head') {
            head.push([val['device_name'], classes])
          } else if (body_area == 'breast') {
            breast.push([val['device_name'], classes])
          } else if (body_area == 'heart') {
            heart.push([val['device_name'], classes])
          } else {
            other.push([val['device_name'], classes])
          }
          
          
      });

          [chest, head, breast, heart, other].forEach(function (item, index) {
          item.forEach(function (x, idx) {
            var html = '<i id="'+x[0]+'" class="'+x[1]+'" data-toggle="tooltip" data-placement="top" title="'+x[0]+'"></i>'
            $( "#figure" ).append(html)
          });
      });

      });



       $( "#multisite" ).click(function() {
        $('.multisite').toggleClass('hover')
        $('#multisite').toggleClass('active')
        });

       $( "#prospective" ).click(function() {
        $('.prospective').toggleClass('hover')
        $('#prospective').toggleClass('active')

        });

       $( "#highrisk" ).click(function() {
        $('.highrisk').toggleClass('hover')
        $('#highrisk').toggleClass('active')

        });

  </script>


</div>
</div>

</div>

<script>
  var color = Chart.helpers.color;

  var pieChartData = {
    type: 'doughnut',
    data: {
      datasets: [{
        data: [
        13, 15, 17, 25, 60
        ],
        backgroundColor: [
        window.chartColors.red,
        window.chartColors.orange,
        window.chartColors.yellow,
        window.chartColors.green,
        window.chartColors.blue,

        ],
        label: 'Body Area'
    }],
    labels: [
    'Chest',
    'Breast',
    'Heart',
    'Head',
    'Multiple/Other'
    ]
},
options: {
  responsive: true,
  legend: {
    position: 'right',
},
title: {
    display: true,
    text: 'Body Area Treated by Devices'
},
animation: {
    animateScale: true,
    animateRotate: true
}
}
};


var barChartData = {
    labels: ['2017', '2018', '2019', '2020'],
    datasets: [

    {
      label: 'AI Devices reporting multisite evaluation',
      yAxisID: 'A',
      stack: 'main',
      backgroundColor: color(window.chartColors.blue).alpha(0.5).rgbString(),
      borderColor: window.chartColors.blue,
      borderWidth: 1,
      data: [
      1, 8, 8, 20
      ]
  },
  {
      label: 'AI Devices approved',
      yAxisID: 'A',
      stack: 'main',
      backgroundColor: color(window.chartColors.blue).alpha(0.1).rgbString(),
      borderColor: window.chartColors.blue,
      borderWidth: 1,
      data: [
      8, 24, 31, 65
      ]
  },
  {
      label: 'Median study sample size',
      yAxisID: 'B',
      backgroundColor: color(window.chartColors.green).alpha(0.5).rgbString(),
      borderColor: window.chartColors.green,
      borderWidth: 2,
      type: 'line',
      cubicInterpolationMode: "monotonic",
      fill: false,
      data: [
      100, 300, 400, 250
      ]
  }]
};

window.onload = function() {

    var ctx1 = document.getElementById('pie').getContext('2d');
    window.myDoughnut = new Chart(ctx1, pieChartData);

    var ctx2 = document.getElementById('bar').getContext('2d');
    window.myBar = new Chart(ctx2, {
      type: 'bar',
      data: barChartData,
      options: {
        responsive: true,
        legend: {
          position: 'top',
      },
      title: {
          display: true,
          text: 'AI device approvals have increased in recent years, but multisite reporting and sample size has stagnated'
      },
      scales: {
       yAxes: [{
          stacked: true,
          id: 'A',
          display: true,
          position: 'left',
          ticks: {
             beginAtZero: true
         }
     }, {
        id: 'B',
        display: true,
        position: 'right',
        ticks: {
           fontColor: color(window.chartColors.green).rgbString(),
           beginAtZero: true,
           max: 700,
           min: 0,
           stepSize: 100
       }
   }]
}
}
});

};

</script>

</div>

</main>



<script>

  $( "#figure" ).on("mouseover", "i", function() {
    $('[data-toggle="tooltip"]').tooltip()
})

  $(function() {
    $('#table').bootstrapTable();
      //$('#table').bootstrapTable('hideColumn', 'query_id');
  })
  function datesSorter(a, b) {
    if (new Date(a) < new Date(b)) return 1;
    if (new Date(a) > new Date(b)) return -1;
    return 0;
}
function numSorter(a, b) {
    a = a.replace(">", "")
    b = b.replace(">", "")
    if (a == 'NA') return 1;
    if (b == 'NA') return -1;
    return Number(b) - Number(a)
}
function detailFormatter(index, row) {
    var html = ""
    $.each(row, function (key, value) {
      if (key == 'indications_for_use') {
        html = "<b>Indications for Use:</b> " + value
    }
})
    return html
}
</script>
</body>
</html>
